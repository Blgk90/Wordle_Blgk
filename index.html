<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="https://ff.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=cz9I08R3loaX7wgr4TvHxqjLoNqoEYDz-Ie1k1LvMPoDzIxc1tAL2HckAJp_Dx2WH_jwUrBMrxquZwm4XiCNzfW8KDnYXe2JBT_PX3V3m0dtZXCiJEEjWXmmy68UXJVubK6U17uMt1P4bAdA_gjBO5W4sLekGIUr42eHjJ3JavFH88bdrl2VE0xf4sCPoMpVEuDyS9E2ViirHGlvomI1mXYuULapnS5-nkUEh1xgTLIgkmBcHLo8qCPhuvG0cV1AgNY7eMiMSIU2uY7HvluQL9JCjwYrjsLsA7rOi3sFxVlL-5UM4DzEM_i4XF8D1OAORXkUwngCKG4gqrVl0V7tI8NtB2zM-_6vCwhciGMfrDrn3CiuT2R_qqbSi6VfQTJeV3cfpV3T0n8Xwjv1FKwuA-vMqpcQnlRsG-N8DyZT2uQhmrC1-izaMow5A5wEsYpqa72QRveytSJ8jGJ1p_-QcX4Edm7XghQTStDnFJGgkHrcld6OnxuIkMeqtn7JFIhmUrbm7BJsphW-xWt0NMiKsJwEjgoltc7_OJLYcD_uf5SNrPUWjG-kwX1G96sBDz1G11k1MhtHZt5O2g1mDe1GMod3FbOSi4VxxVwUHiUv7FLo7rCVjutCLsur8uD0NRWwQXrn8BJfuhhRibrw2plBEkATrJFLuZ3WQAn4HwIX28pHs8IAlRGsJNA94PUUg6PBV3h6C9MXpzvBVTZGIQTwQ5HZ_9C-zL0WdASnSuQRvnvhgjhtcsLnkcBbQuYLxtlBWpC41NthoCFOqSQj1nOLY50ZDlX_8n1GWBEYEgjFqJqjtalRDWSsaRo92C77HfzYtwv70nsJGN9xHBz-2NvyymrAs62BpaRxs8FRdS4wuniRhPrc7XmcpywqXEAZV5zBz2WTLuvLxYeCw0sck1t25US_5DtZ8hOLC-A9PPPPIetW7vCar3wQLuIYKqKZyLa06-S6AtT313_DKeOKb82raIeYG8SHmncdAwoWuhdp24YOTXWq8sOtdnMgyi5Uku-w5vxZ0KqMZLDZek70hF6cGkznaAi44SgVvivXvR98aTitDRo750NGMgozvt4hze8GSQEovZ89qrfoNC-41FmOXGCQnEVBFr78oxgmX7ZwJN1bBptLVpYWn_TF2e5mbIZ6XBvj94iXGRgV8dA7R4HqoZvyrYndcPK0cSSNLDUGT0antQA-U35JeXZyidYunAfycBYyggptUM8DzGaJeAGjrwMmYveTyCA0_ejhdNMec1fATEx41Nncw_KMs2A379FTBLo9qkSxyUbnJv1B_dWwZZvXb8S1qNm7x42JIQnFgo0IOiDZ_lgNZa8NMYWlnJIAVtdOyTdL2cwDbC6HG-gtTbyUGCqiMnmyN1T67ekYJmv71nh-tz9Wj-fPI2KBGOWQWKi-LJMlByogEynivFlmA03p771vQcosW_EmOikYXxPqDmUl-Og7ePusHXMe_-xuv8nEGtRWuc2OE6r7_RS-KOT_EiEur4jY_ZRW84u4YwcviveWjgSUyJ0p8S9SqsQkOPjVHD2ylhK5VlJRhaRZ0Kb_M8ZzENSlMDCkr3-F8uRK1FektWV-CU6OZw9FKO7JqKiCUJbn5yu5uPYapJJaubgPiWp6V7Pw9TT25p4PY_yCjTPfjoyGIJu9U5iMnJZjDjSHPwu3qcnaA-Y6DrjOifSJwWx2t0uDz2q92Y7D92kkwJlwLAoWOIIdvivAeBTYcyIRLedFlsRGciD_dCxLkVAtbiZ12AjY0u6pQ455P09w-ccRCHSM8UH7vsNU0erBdebGXRBsS_xBYKgIVGo83i_F5jJ0xj6yzn6KtLRE3NmBB9dv8AZ6kna4W43lA1V-YqCpirh3E5P6NGyKzAZVd12ox__9sv3gZkEXW_bovT7uYO-hanEz9N5eEnhLKbgUE9RC09uwVnlUD1gWNoF2DQURfoKLA35y3b1Nw5FeHko" charset="UTF-8"></script><style>

        td
        {
            border: 1px solid black;
            width:20px;
            height: 20px;
            text-align: center;
        }

        .red
        {
            background-color: red;
        }

        .orange
        {
            background-color: orange;
        }

        .green
        {
            background-color: green;
        }

      

        .hidden
        {
            display:none;
        }

        .visible
        {
            display: block;
        }
       .ranking
        {
            border-width: 1px;
            border-color: black;
            border-style: solid;
            
        }
      
        
    </style>
</head>
<body>
    

    <div id="mainContainer">
        <input type="text" maxlength="5" name="" id="parola">
        <input type="submit" name="" id="btn">

        <table>
            <tr>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
            </tr>
            <tr>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
            </tr>
            <tr>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
            </tr>
            <tr>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
            </tr>
            <tr>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
            </tr>
            
        </table>

    </div>

    <div id="riprova" class="hidden">
        <input type="submit" name="" value="Riprova" id="riprovaBtn">
    </div>

    <div id="feed" class="hidden">
        <h1 class="green">Congratulazioni hai indovinato!!! </h1>
        <label for="nomeCog">Inserisci nome e cognome</label>
        <input type="text" name="" id="nomeCog">
        <input type="submit" name="" id="btnNomeCog">
        </div>
    
    <div class="demo"></div>
    <br>
    <br>
    <br>
    <div class="ranking">
        
    </div>











<!-- -----------------------------------------------------------------INIZIO SCRIPT------------------------------------------ -->
    <script>

        let btn = document.querySelector("#btn");
        let riprovaBtn = document.querySelector("#riprovaBtn");
        let parolaDelGiorno = ["istmo","pesca","furto","canna","laser","nonno","polpo","avido"];
        let lList = document.querySelectorAll("td");
        let btnNomeCog = document.querySelector("#btnNomeCog");
        let feed = document.querySelector("#feed");
        let parolaOBJ = document.querySelector("#parola");

        let numWinner = 0;
        let indovinate = 0;
        let tentativi = 0;

        let mainContainer = document.querySelector("#mainContainer");
        let demo = document.querySelector(".demo");
        let riprova = document.querySelector("#riprova");
        let nomeCogOBJ = document.querySelector("#nomeCog");
        let ranking = document.querySelector(".ranking");
        
        // Se nella local storage esiste già un file con salvato il numero di vincitori, allora prendo il numero e lo carico dentro la variabile numWinner

        if(localStorage.getItem("numeroWinner"))
        {
            numWinner = (JSON.parse(localStorage.getItem("numeroWinner"))).numero
        }
      
        // costruttore dell'oggetto Winner, necessario per salvare il numero di vincitori in formato JSON in quanto si possono utilizare solo gli oggetti per salvare in JSON

        function Winner (numero)
        {
            this.numero = numero;
        }

        // costruttore dell'oggetto User, necessario per salvare il nome e la parola indovinata in formato JSON in quanto si possono utilizare solo gli oggetti per salvare in JSON

        function User (nomeCog,parolaInd)
        {
            this.nomeCog = nomeCog;
            this.parolaInd = parolaInd;
        }

        //  controlla se la parola ha esattamente 5 lettere, se non le ha restituisce un errore (in realtà non puo averne di piu in quanto il maxlenght dell'html lo impedisce)

        function validate ()
        {
            let parola = document.querySelector("#parola").value;
            if(parola.length < 5 || parola.length > 5)
            {
                alert("Inserisci almeno 5 lettere")
            }

            // se le lettere sono 5, passa alla funzione di inserimento 
            else
            {
                inserisci();
            }
        }



        function inserisci()
        {
            // come prima cosa verifica se il numero di tentativi effettuati è uguale a 25 che è il massimo;
                        // se sì azzera tutte le caselle e rimuove le classi e nasconde il tasto di riprova
            if(tentativi == 25)
                    {
                        for(let i = 0 ; i<25 ; i++)
                        {
                            lList[i].innerHTML = "";
                            lList[i].className ="";
                            tentativi = 0;
                            riprova.className = "hidden";
                        }
                    }
                    else
                    {
                        // in caso contrario prosegue con l'inserimento

                        demo.innerHTML = ""
                        // variabile che conta le lettere indovinate
                        let rightWord = 0; 
                        let parola = document.querySelector("#parola").value;
                        let parolaArray = parola.split("");
                        console.log(parolaArray);

                        // Funzione per implementare varie parole 

                        let parolaDelGiornoSplit = parolaDelGiorno[indovinate].split("");

                        

                        for (let i = 0 ; i<5; i++)
                        {

                            

                            if(parolaArray[i] == parolaDelGiornoSplit[i])
                            {
                                lList[i+tentativi].innerHTML= parolaArray[i];

                                //  se le lettere sono giuste rimuove il colore rosso e le mette in verde
                                lList[i+tentativi].className = "green";
                                rightWord++;

                            }
                            else if(parolaDelGiornoSplit.indexOf(parolaArray[i]) != -1)
                            {
                                lList[i+tentativi].innerHTML= parolaArray[i];
                                lList[i+tentativi].className = "orange";
                            }
                            else
                            {
                                //  se le lettere sono sbagliate rimuove il colore verde e le mette in rosso
                                lList[i+tentativi].innerHTML= parolaArray[i];
                                lList[i+tentativi].className = "red";
                            }
                        }
                        
                        

                        //  se le lettere indovinate sono 5 , quindi l'intera parola , rende visibile il form di inserimento dati
                        if(rightWord == 5)
                        {
                            feed.className = "visible";
                            mainContainer.className = "hidden";
                        }     
                        // altrimenti incrementa il counter "tentativi" di 5 , scrivendo quindi nella riga successiva
                        else
                        {
                            tentativi = tentativi+5;
                            console.log(tentativi);
                        }

                        // come ultima cosa verifica se il numero di tentativi effettuati è uguale a 25 che è il massimo;
                        // se sì, lancia un alert, azzera tutte le caselle e rimuove le classi
                    

                        if(tentativi == 25)
                            {
                                alert("Hai finito i tentativi!");

                                riprova.className = "visible";

                                // for(let i = 0 ; i<25 ; i++)
                                // {
                                //     lList[i].innerHTML = "";
                                //     lList[i].className ="";
                                //     tentativi = 0;
                                // }

                            }
                    }
           
        }


        function submitScore ()
        {
            

            let userName = document.querySelector("#nomeCog").value;

            // unisce la parola del giorno, per usarla come stringa
            let parola = parolaDelGiorno[indovinate];

            //  salva i dati del vincitore in un nuovo oggetto
            let newWinner = new User(userName,parola);

            // trasforma in formato JSON l'oggetto con i dati appena salvati
            let newWinnerJson = JSON.stringify(newWinner);

            // salva il JSON nella Local Storage
            localStorage.setItem("Vincitore Numero "+numWinner,newWinnerJson);

            demo.innerHTML = "<p class='green'>Sei stato registrato correttamente!</p>" 
            //  pulisce l'input con i dati del vincitore 
            nomeCogOBJ.value = "";
            //  nasconde il form di inserimento
            feed.className = "hidden";

            console.log("Variabile NumWinner--> "+numWinner);

            //  viene incrementato il counter dei vincitori e delle parole indovinate
            numWinner++;
            indovinate++;

            //  lancia la funzione che costruisce la tabella del ranking 
            buildRanking();

            // crea un JSON contenente il numero di vincitori e lo salva nella local storage
            let winnerJSON = new Winner(numWinner);
            localStorage.setItem("numeroWinner",JSON.stringify(winnerJSON));

            // cancella la tabella e resetta i tentativi

            for(let i = 0 ; i<25 ; i++)
                {
                    
                    lList[i].innerHTML = "";
                    lList[i].className ="";
                    tentativi = 0;
                }
            
                mainContainer.className = "visible";
                parolaOBJ.value = "";
        }

        function buildRanking()
        {   
            console.log("sono dentro Build Ranking");

            //  array di supporto dove vengono caricati gli oggetti contenenti i nomi dei vincitori e le parole, che vengono presi dalla localstorage

            let winner = [];
            let i = 0;

            //  all'inizio pulisce sempre il div contenente il ranking
            ranking.innerHTML= "";

            while (i < numWinner)
            {
                // inserisce nell'array vuoto gli oggetti salvati nella local storage che hanno nome progressivo "VINCITORE NUMERO" seguto dal numero, ed infine li stampa
                console.log("sono nel loop");
                winner[i] = JSON.parse(localStorage.getItem("Vincitore Numero "+i));

                    // fix per correggere il bug di quando si cancella qualche record dalla local storage,
                    // dato che prima di stampare controlla se il record esiste, non da errore in caso di record non trovato
                    if(winner[i] != null)

                    {
                    console.log(winner[i]);

                    ranking.innerHTML += "<p>Vincitore numero "+(i+1)+": "+winner[i].nomeCog+", Parola indovinata: "+winner[i].parolaInd+"</p>"

                    
                    }

                    i++;
                }
            

        }


        buildRanking();


        // lista degli oggetti con i vari listener

        btn.addEventListener("click",validate);

        parolaOBJ.addEventListener("keyup",function(){
            if (event.key == "Enter")
            {
                validate();
            }
        })

        btnNomeCog.addEventListener("keyup",function()
        {
            let nomeCog = document.querySelector("#nomeCog").value;

            if(nomeCog != "")
            {
                submitScore();
                nomeCogOBJ.className = "";
            }
            else 
            {
                alert("non puoi lasciare il campo vuoto!");
                nomeCogOBJ.className = "red";
            }
        })

        btnNomeCog.addEventListener("click",function()
        {
            let nomeCog = document.querySelector("#nomeCog").value;

            if(nomeCog != "")
            {
                submitScore();
                nomeCogOBJ.className = "";
            }
            else 
            {
                alert("non puoi lasciare il campo vuoto!");
                nomeCogOBJ.className = "red";
            }
        })

        riprovaBtn.addEventListener("click",function(){

            for(let i = 0 ; i<25 ; i++)
                        {
                            lList[i].innerHTML = "";
                            lList[i].className ="";
                            tentativi = 0;
                        }

                        riprova.className = "hidden";
            
        })

        
        
        
        
    </script>
</body>
</html>